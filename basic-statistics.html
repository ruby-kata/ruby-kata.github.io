<!DOCTYPE html>
<html>
    <head>
        <title>Kata</title>
        <meta name="viewport" content="width=device-width,initial-scale=1">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/6.65.7/codemirror.min.css">
        <link rel="stylesheet" href="./codekata.css">
        <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/6.65.7/codemirror.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/6.65.7/keymap/sublime.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/6.65.7/addon/comment/comment.min.js"></script>
        <script src="https://codemirror.net/mode/ruby/ruby.js"></script>
        <script type="module">
            import { DefaultRubyVM } from "https://cdn.jsdelivr.net/npm/@ruby/wasm-wasi@2.5.0/dist/browser/+esm";
            import { Application, Controller } from "https://unpkg.com/@hotwired/stimulus/dist/stimulus.js"

            window.Stimulus = Application.start()

            Stimulus.register("codekata", class extends Controller {
                connect() {
                    this.setup()
                }

                async setup() {
                    this.editor = CodeMirror.fromTextArea(document.getElementById('editor'), {
                        mode: "ruby",
                        lineNumbers: true,
                        keyMap: 'sublime',
                        extraKeys: {
                            "Alt-Up": "swapLineUp",
                            "Alt-Down": "swapLineDown",
                        }
                    });
                    this.editor.setValue(`# code-kata
class Array
   def mean
   end

   def median
   end

   def standard_deviation
   end

   def modes
   end
end                    
                    `)
                
                    const response = await fetch("https://cdn.jsdelivr.net/npm/@ruby/3.3-wasm-wasi@2.5.0/dist/ruby+stdlib.wasm");
                    const module = await WebAssembly.compileStreaming(response);
                    const { vm } = await DefaultRubyVM(module);
                    this.vm = vm
                }
                
                run() {
                    const code = this.editor.getValue()
                    const result = this.vm.eval(`
                        begin
                            ${code}

                            count = 0
                            (testcases = [
                                ['[1,2,2,3,5].mean', 2.6],
                                ['[100,100,100,100.1].mean', 100.025],
                                ['[1,2,2,3,5].median', 2],
                                ['[2,3,-100,100].median', 2.5],
                                ['[1, 1, 10, 100, 1000].median', 10],
                                ['[1,2,2,3,5].standard_deviation', 1.52],
                                ['[1,1,2,2,3,4,4,4,4,4].modes', [4]],
                                ['[1,1,2,2,3,4,4].modes', [1,2,4]],
                                ['[1,2,3].modes', []],
                            ]).map { |func, expected|
                                reality = eval(func)
                                reality == expected ? (count += 1) && "assert_equal #{func}, #{expected} # OK" : "assert_equal #{func}, #{expected} # FAILED get: #{reality.nil? ? 'nil' : reality}"
                            }
                            .join('\n') + "\n--------------------------------------\nOK: #{count}, FAILED: #{testcases.size - count}"
                        rescue => error
                            error
                        end
                    `);
                
                    document.getElementById('result').textContent = result
                }
            })
      </script> 
    </head>
  
    <body>
        <div data-controller="codekata" class="page">
            <textarea class="kata" readonly>
basic-statistic

Statistics is a field of mathematics that pertains to data analysis. Statistical methods and equations can be applied to a data set in order to analyze and interpret results, explain variations in the data, or predict future data. 

A few examples of statistical information we can calculate are:

  + Average value (mean)
  + Most frequently occurring value (mode)
  + On average, how much each measurement deviates from the mean (standard deviation of the mean)
  + Span of values over which your data set occurs (range), and
  + Midpoint between the lowest and highest value of the set (median)

For example:

 the mean of [1,2,2,3,5] is 2.6
 the median of [1,2,2,3,5] is 2
 the standard_deviation of [1,2,2,3,5] is 1.52
 the only mode of [1,1,2,2,3,4,4,4,4,4] is 4 
 modes of [1,1,2,2,3,4,4] are [1,2,4] 
 there is no modes in [1,2,3]

            </textarea>
            <div class="solution">
                <textarea id="editor"></textarea>
                <button data-action="click->codekata#run" class="run">run</button>
                <textarea id="result" class="result" readonly>
assert_equal [1,2,2,3,5].mean, 2.6
assert_equal [100,100,100,100.1].mean, 100.025
assert_equal [1,2,2,3,5].median, 2
assert_equal [2,3,-100,100].median, 2.5
assert_equal [1, 1, 10, 100, 1000].median, 10
assert_equal [1,2,2,3,5].standard_deviation, 1.52
assert_equal [1,1,2,2,3,4,4,4,4,4].modes, [4] 
assert_equal [1,1,2,2,3,4,4].modes, [1,2,4] 
assert_equal [1,2,3].modes, [] 
                </textarea>
            </div>
        </div>

        <div class="footer">
            <a href="./index.html">./ruby-kata-list</a><span>/basic-statistic</span>
        </div>
    </body>
</html>