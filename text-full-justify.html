<!DOCTYPE html>
<html>
    <head>
        <title>Kata</title>
        <meta name="viewport" content="width=device-width,initial-scale=1">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/6.65.7/codemirror.min.css">
        <link rel="stylesheet" href="./codekata.css">
        <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/6.65.7/codemirror.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/6.65.7/keymap/sublime.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/6.65.7/addon/comment/comment.min.js"></script>
        <script src="https://codemirror.net/mode/ruby/ruby.js"></script>
        <script type="module">
            import { DefaultRubyVM } from "https://cdn.jsdelivr.net/npm/@ruby/wasm-wasi@2.5.0/dist/browser/+esm";
            import { Application, Controller } from "https://unpkg.com/@hotwired/stimulus/dist/stimulus.js"

            window.Stimulus = Application.start()

            Stimulus.register("codekata", class extends Controller {
                connect() {
                    this.setup()
                }

                async setup() {
                    this.editor = CodeMirror.fromTextArea(document.getElementById('editor'), {
                        mode: "ruby",
                        lineNumbers: true,
                        keyMap: 'sublime',
                        extraKeys: {
                            "Alt-Up": "swapLineUp",
                            "Alt-Down": "swapLineDown",
                        }
                    });
                    this.editor.setValue(`# ruby-kata
class String
	def full_justify(max_width)

    end
end
                    `)
                
                    const response = await fetch("https://cdn.jsdelivr.net/npm/@ruby/3.3-wasm-wasi@2.5.0/dist/ruby+stdlib.wasm");
                    const module = await WebAssembly.compileStreaming(response);
                    const { vm } = await DefaultRubyVM(module);
                    this.vm = vm
                }
                
                run() {
                    const code = this.editor.getValue()
                    const testcases = `
                        count = 0
                        cases = [
                            ["'This is an example of text justification.'.full_justify(16)", 'This    is    an\nexample  of text\njustification.  '],
                            ["'What must be acknowledgment shall be'.full_justify(16)", 'What   must   be\nacknowledgment  \nshall be        '],
                            ["'Science is what we understand well enough to explain to a computer. Art is everything else we do'.full_justify(20)", 'Science  is  what we\nunderstand      well\nenough to explain to\na  computer.  Art is\neverything  else  we\ndo                  ']
                        ].map do |reality, expected|
                            eval(reality) == expected ? (count += 1) && "assert_equal #{reality},\n#{expected} # OK\n" : "assert_equal #{reality},\n#{expected} # FAILED\n"
                        end
                        
                        cases.join('\n') + "\n--------------------------------------\nOK: #{count}, FAILED: #{cases.size - count}"
                    `

                    const result = this.vm.eval(`
                        begin
                            ${code}
                            ${testcases}
                        rescue => error
                            error
                        end
                    `);
                
                    document.getElementById('result').textContent = result
                }
            })
      </script> 
    </head>
  
    <body>
        <div data-controller="codekata" class="page">
            <textarea class="kata" readonly>
text-full-justify

Given a text with max_width, format the text such that each line has exactly max_width characters and is fully (left and right) justified. 
For the last line of text, it should be left-justified.

For example:

"This is an example of text justification.".full_justify(16)
# => "This    is    an\nexample  of text\njustification.  "

"What must be acknowledgment shall be".full_justify(16)
# => "What   must   be\nacknowledgment  \nshall be        "

"Science is what we understand well enough to explain to a computer. Art is everything else we do".full_justify(20)
# =>   "Science  is  what we\nunderstand      well\nenough to explain to\na  computer.  Art is\neverything  else  we\ndo                  "


reference: https://leetcode.com/problems/text-justification
            </textarea>
            <div class="solution">
                <textarea id="editor"></textarea>
                <button data-action="click->codekata#run" class="run">run</button>
                <textarea id="result" class="result" readonly>
assert_equal 'This is an example of text justification.'.full_justify(16), 
             'This    is    an
              example  of text
              justification.  '

assert_equal 'What must be acknowledgment shall be'.full_justify(16), 
             'What   must   be
              acknowledgment  
              shall be        '

assert_equal 'Science is what we understand well enough to explain to a computer. Art is everything else we do'.full_justify(20), 
             'Science  is  what we
              understand      well
              enough to explain to
              a  computer.  Art is
              everything  else  we
              do                  '


                </textarea>
            </div>
        </div>

        <div class="footer">
            <a href="./index.html">./ruby-kata-list</a><span>/text-full-justify</span>
        </div>
    </body>
</html>